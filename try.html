<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>贪吃蛇游戏</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            background-color: black; /* 页面背景色为黑色 */
            color: white; /* 文字颜色为白色 */
            font-family: Arial, sans-serif;
        }

        h1 {
            margin-bottom: 20px;
        }

        canvas {
            background-color: lightgray; /* 画布背景色为浅灰色 */
            border: 2px solid white; /* 画布边框为白色 */
        }

        #gameOverMessage {
            display: none;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 24px;
            color: red;
        }

        #scoreDisplay {
            margin-top: 20px;
            font-size: 20px;
        }

        button {
            margin-top: 20px;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            background-color: #4CAF50; /* Green */
            border: none;
            color: white;
            border-radius: 5px;
        }

        button:hover {
            background-color: #45a049; /* Darker green */
        }
    </style>
</head>
<body>
    <h1>贪吃蛇游戏</h1>
    <canvas id="gameCanvas" width="400" height="400"></canvas>
    <div id="gameOverMessage">游戏结束</div>
    <div id="scoreDisplay">分数：0</div>
    <button id="startButton">开始游戏</button>
    <button id="restartButton" style="display:none;">重新开始</button>

    <!-- Audio elements for sound effects -->
    <audio id="eatSound" src="eat.mp3"></audio>
    <audio id="crashSound" src="crash.mp3"></audio>

    <script>
        // Get canvas element and context
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        // Define block size
        const blockSize = 20;

        // Initialize snake
        let snake = [
          { x : canvas.width /2 , y : canvas.height /2 },
          { x : canvas.width /2 - blockSize , y : canvas.height /2 },
          { x : canvas.width /2 - blockSize *2 , y : canvas.height /2 }
         ];

         // Initialize direction
         let direction='right';

         // Game state
         let gameOver=false;

         // Score variable
         let score=0;

         // Food position
         let food={x :0,y :0};

         // Generate food position 
         function generateFood(){
             let foodX,foodY ;
             let isOnSnake ;

             do{
                 foodX=Math.floor(Math.random()*(canvas.width/blockSize))*blockSize ;
                 foodY=Math.floor(Math.random()*(canvas.height/blockSize))*blockSize ;

                 isOnSnake=snake.some(segment=>segment.x===foodX && segment.y===foodY );
             }while(isOnSnake);

             food.x=foodX ;
             food.y=foodY ;
         }

         // Draw food 
         function drawFood(){
             ctx.fillStyle='red' ; 
             ctx.fillRect(food.x,food.y ,blockSize ,blockSize );
         }

         // Initialize game by generating first piece of food 
         generateFood();

         // Update snake's position 
         function updateSnake(){
             if(gameOver) return ;

             let headX=snake[0].x ;
             let headY=snake[0].y ;

             if(direction==='right'){
                 headX+=blockSize ;
             }else if(direction==='left'){
                 headX-=blockSize ;
             }else if(direction==='up'){
                 headY-=blockSize ;
             }else if(direction==='down'){
                 headY+=blockSize ;
             }

             if(headX<0 || headX>=canvas.width || headY<0 || headY>=canvas.height ){
                 gameOver=true ;
                 document.getElementById('gameOverMessage').style.display='block' ; 
                 document.getElementById('restartButton').style.display='block';
                 document.getElementById('crashSound').play();
                 return ;
              }

              for(let i=1;i<snake.length;i++){
                  if(headX===snake[i].x && headY===snake[i].y ){
                      gameOver=true ; 
                      document.getElementById('gameOverMessage').style.display='block' ; 
                      document.getElementById('restartButton').style.display='block';
                      document.getElementById('crashSound').play();
                      return ; 
                   }
               }

               if(headX===food.x && headY===food.y ){
                   snake.unshift({x :headX ,y :headY });
                   generateFood();
                   score++;
                   document.getElementById('scoreDisplay').innerText=`分数：${score}`; 
                   document.getElementById('eatSound').play();
               }else{
                   snake.unshift({x :headX ,y :headY });
                   snake.pop();
                }
          }

          // Clear canvas 
          function clearCanvas(){
              ctx.clearRect(0 ,0 ,canvas.width ,canvas.height );
          }

          // Draw snake 
          function drawSnake(){
              ctx.fillStyle='green' ; 
              for(let i=0;i<snake.length;i++){
                  ctx.fillRect(snake[i].x,snake[i].y ,blockSize ,blockSize );
                  ctx.strokeStyle='darkgreen' ; 
                  ctx.strokeRect(snake[i].x,snake[i].y ,blockSize ,blockSize );
               }
           }

           // Game loop 
           function gameLoop(){
               clearCanvas();
               drawSnake();
               drawFood();
               updateSnake();

               if(!gameOver){
                   setTimeout(() => {
                       requestAnimationFrame(gameLoop);
                   }, 200); // 添加200毫秒的延迟，使蛇移动变慢
                }
           }

           // Start game when start button is clicked
           document.getElementById('startButton').addEventListener('click', () => {
               gameLoop();
               document.getElementById('startButton').style.display = 'none';
           });

           // Restart game when restart button is clicked
           document.getElementById('restartButton').addEventListener('click', () => {
               snake = [
                   { x : canvas.width /2 , y : canvas.height /2 },
                   { x : canvas.width /2 - blockSize , y : canvas.height /2 },
                   { x : canvas.width /2 - blockSize *2 , y : canvas.height /2 }
                ];
                direction = 'right';
                gameOver = false;
                score = 0;
                document.getElementById('scoreDisplay').innerText=`分数：${score}`; 
                document.getElementById('gameOverMessage').style.display = 'none';
                document.getElementById('restartButton').style.display = 'none';
                generateFood();
                gameLoop();
           });

           // Handle keyboard input for changing direction of the snake
           document.addEventListener('keydown', (event) => {
               switch(event.key){
                    case 'ArrowUp':
                        if(direction!=='down') direction='up'; break; case 'ArrowDown':
                        if(direction!=='up') direction='down'; break; case 'ArrowLeft':
                        if(direction!=='right') direction='left'; break; case 'ArrowRight':
                        if(direction!=='left') direction='right'; break;}
                    });
       </script></body></html>